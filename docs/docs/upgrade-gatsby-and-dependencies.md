---
title: マイナーリリースまたはパッチリリースのアップグレード
---

Gatsby とそれに依存するパッケージの両方の最新のバグ修正、セキュリティパッチ、およびマイナーリリースに追従するには、それぞれを最新バージョンに頻繁にアップグレードする必要があります。

## セマンティックバージョニング

他の多くのパッケージと同様に、Gatsby は[セマンティックバージョニング](https://semver.org/)を使用して新しいバージョンを付けることで、新しいリリースで導入された各種の変更を示します。

このガイドは、Gatsby をマイナーリリースまたはパッチリリースについてアップグレードする方法を解説します。メジャーアップグレードに対するガイドは、[リリースと移行](/docs/releases-and-migration/)のリファレンスから該当するガイドをご覧ください。

## Gatsby とそれに依存するパッケージをアップグレードすべき理由

それぞれのパッケージの新しいバージョンには、パフォーマンス、アクセシビリティ、セキュリティ、バグ修正など、多方面での改善がなされているため、Gatsby とそれに依存するパッケージの両方をアップグレードすることは、これらの最新の改善を反映させる上で重要です。

マイナーリリースまたはパッチリリースの依存パッケージを頻繁にアップグレードすることで、メジャーアップグレードを容易にし、廃止予定の機能または API を特定するのにも役立ちます。

## 利用可能なアップグレードを特定する方法

まず、`outdated`コマンドを実行して、すべての依存パッケージに対する最新のリリースを特定できます。

```shell
npm outdated
```

これにより、最新のバージョンが利用可能なパッケージ名とその最新バージョンを示した表が出力されます。

```shell
Package                            Current   Wanted   Latest  Location
gatsby                             2.15.13  2.15.13  2.15.20
```

## アップグレードしたい依存パッケージを設定する

Gatsby とそれに依存するパッケージのマイナーリリースもしくはパッチリリースのどちらをアップグレードするかによって、`package.json`を適宜修正する必要があります。

**パッチリリース**のみを更新したい場合は、パッケージのバージョンの前にチルダ（`〜`）を追加します。

```json:title=package.json
"dependencies"{
  "gatsby": "~2.15.13",
}
```

**マイナーリリースとパッチリリースの両方**を更新したい場合は、パッケージのバージョンの前にキャレット（`^`）を追加します。

```json:title=package.json
"dependencies"{
  "gatsby": "^2.15.13",
}
```

メジャーアップデートについては、[リリースと移行](/docs/releases-and-migration/)のリファレンスから該当するガイドをご覧ください。

Gatsby を更新する場合は、Gatsby 関連のプラグインも更新する必要があります。`gatsby-`で始まる名前から Gatsby 関連のプラグインであるどうか識別できます。このルールは、[gatsbyjs/gatsby](https://github.com/gatsbyjs/gatsby)リポジトリーで管理されているプラグインにのみ適用されます。サードパーティー製のプラグインの場合、アップグレード可能な新しいバージョンがあるかどうかを事前に確認してください。

## すべての依存パッケージを一度に更新する

対応するアノテーションを `package.json`ファイルに追加した後、更新コマンドを実行します。

```shell
npm update
```

これにより、最新のパッチリリース、マイナーリリース、メジャーリリースについて、`package.json`のアノテーションに応じて、すべてのパッケージが最新の[任意のバージョン](https://docs.npmjs.com/cli/outdated)にアップグレードされます。

## 個々の依存パッケージをアップグレードする

npm の `install`コマンドを使うことで、インストールしたいバージョンで特定のパッケージを個別に更新することもできます。

```shell
npm install <package-name>@<version> --save
```

インストールまたはアップグレードするバージョンを、次の形式で指定できます。

- `@`の後に特定のバージョンを指定します。
- 最新のメジャーリリース、マイナーリリース、またはパッチリリースを、それぞれ `*` 、 `^`、 `〜`のアノテーション付きバージョンで指定します。
- バージョンを数字ではなく `x`を使用して、最新のメジャーリリース（`x`）、マイナーリリース（`<major>.x`）、またはパッチリリース（`<major>.<minor>.x`）のバージョンを指定することもできます。たとえば、特定のメジャーバージョンとマイナーバージョンの最新のパッチリリースをインストールする場合、`npm install package-name@2.1.x --save`となります。

メジャーアップグレードについては、[リリースと移行](/docs/releases-and-migration/)リファレンスガイドの概要から対応するガイドを必ず確認してください。

## インタラクティブなアップグレード

[npm-check](https://www.npmjs.com/package/npm-check)モジュールを使用して、更新対象の依存パッケージを手動で選択できます。これを行うには、まずモジュールをインストールすることから始めましょう。

```shell
npm install npm-check --save-dev
```

次に、下記のコマンドを package.json ファイルに追加します。

```json:title=package.json
{
  "scripts": {
    "upgrade-interactive": "npm-check --update"
  }
}
```

最後に、先ほど追加したコマンドを実行します。

```shell
npm run upgrade-interactive
```

## トラブルシューティング

[Gatsby における Node 6 サポートの終了](/blog/2019-06-18-dropping-support-for-node-6/)などの特定のケースを除き、マイナーリリースもしくはパッチリリースのアップグレードでは、コードを修正する必要はありません。Gatsby またはその依存パッケージをアップグレードした後、テストスイートがある場合はそれを実行することをお勧めします。

依存関係の競合が発生した場合は、[npm-force-resolutions パッケージ](https://www.npmjs.com/package/npm-force-resolutions?activeTab=readme)を使用して問題を解決できます。

## 関連資料

Gatsby のメジャーアップグレードについては、これらのガイドをご覧ください。

- [v1 から v2 への移行](/docs/migrating-from-v1-to-v2/)
- [v0 から v1 への移行](/docs/migrating-from-v0-to-v1/)
